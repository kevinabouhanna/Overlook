---
import MainLayout from '../../layouts/MainLayout.astro';
import { servicesMap } from '../../data/services.js';
import type { Service, ServiceFeature, ServicesMap } from '../../types/services';
import OptimizedImage from '../../components/common/OptimizedImage.astro';

// Services data is imported from '../../data/services.js'

// Define the getStaticPaths function to pre-generate all service pages at build time
export function getStaticPaths() {
  // Type assertion for servicesMap
  const typedServicesMap = servicesMap as ServicesMap;

  // Return an array of objects with the params for each service page
  return Object.keys(typedServicesMap).map((serviceId: string) => {
    // Type guard: Ensure serviceId is a valid key in typedServicesMap
    if (!(serviceId in typedServicesMap)) {
      throw new Error(`Invalid service ID: ${serviceId}`);
    }

    return {
      params: { serviceId },
      props: { service: typedServicesMap[serviceId] }
    };
  });
}

// Get the service data from props
const { service } = Astro.props as { service: Service };

// Set the page metadata
const title = `${service.title} - Overlook Sales Consulting`;
const description = service.longDescription.substring(0, 160);
---

<MainLayout
  title={title}
  description={description}
  ogImage={service.image}
>
  <!-- Hero Section -->
  <section class="relative h-96">
    <div class="absolute inset-0">
      <OptimizedImage
        src={service.image}
        alt={service.title}
        class="w-full h-full object-cover"
        width={1200}
        height={600}
        loading='eager'
      />
      <div class="absolute inset-0 bg-black/50"></div>
    </div>
    <div class="container mx-auto px-4 h-full relative z-10">
      <div class="flex flex-col justify-center h-full">
        <h1 class="text-4xl md:text-5xl font-bold mb-4 text-white">{service.title}</h1>
        <p class="text-xl text-gray-200 max-w-2xl">
          {service.description}
        </p>
      </div>
    </div>
  </section>

  <!-- Overview Section -->
  <section class="py-16 bg-white">
    <div class="container mx-auto px-4">
      <div class="max-w-3xl mx-auto">
        <h2 class="text-3xl font-bold mb-6">Overview</h2>
        <p class="text-lg text-gray-700 mb-8">
          {service.longDescription}
        </p>

        <h3 class="text-2xl font-bold mb-4">Benefits</h3>
        <ul class="list-disc list-inside space-y-2 text-lg text-gray-700 mb-8">
          {Array.isArray(service.benefits)
            ? service.benefits.map((benefit: string) => (
                <li>{benefit}</li>
              ))
            : null
          }
        </ul>
      </div>
    </div>
  </section>

  <!-- Features Section -->
  <section class="py-16 bg-gray-50">
    <div class="container mx-auto px-4">
      <div class="max-w-3xl mx-auto">
        <h2 class="text-3xl font-bold mb-12 text-center">Key Features</h2>

        <div class="space-y-12">
          {Array.isArray(service.features)
            ? service.features.map((feature: ServiceFeature, index: number) => (
            <div class="flex flex-col md:flex-row animate-on-scroll" style={{ transitionDelay: `${index * 0.1}s` }}>
              <div class="md:w-16 w-full flex-shrink-0 flex md:justify-center">
                <div class="w-12 h-12 bg-black text-white rounded-full flex items-center justify-center text-xl font-bold mb-4 md:mb-0">
                  {index + 1}
                </div>
              </div>
              <div class="md:ml-8">
                <h3 class="text-xl font-bold mb-2">{feature.title}</h3>
                <p class="text-gray-700">{feature.description}</p>
              </div>
            </div>
          ))
            : null
          }
        </div>
      </div>
    </div>
  </section>

  <!-- CTA Section -->
  <section class="py-16 bg-white">
    <div class="container mx-auto px-4">
      <div class="max-w-3xl mx-auto text-center">
        <h2 class="text-3xl font-bold mb-6">Ready to Get Started?</h2>
        <p class="text-xl text-gray-700 mb-8">
          Contact us today to learn more about our {service.title} service and how it can benefit your organization.
        </p>
        <div class="flex flex-col sm:flex-row gap-4 justify-center">
          <a
            href="/contact"
            class="bg-black text-white px-6 py-3 rounded-md text-base font-medium hover:bg-gray-800 transition-colors"
          >
            Contact Us
          </a>
          <a
            href="/services"
            class="bg-white text-black border-2 border-black px-6 py-3 rounded-md text-base font-medium hover:bg-gray-100 transition-colors"
          >
            Explore Other Services
          </a>
        </div>
      </div>
    </div>
  </section>
</MainLayout>

<script>
  // Scroll animations
  document.addEventListener('DOMContentLoaded', () => {
    const animateOnScroll = document.querySelectorAll('.animate-on-scroll');

    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          entry.target.classList.add('animated');
        }
      });
    }, { threshold: 0.1 });

    animateOnScroll.forEach(element => {
      observer.observe(element);
    });
  });
</script>
